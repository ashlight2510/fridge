<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ëƒ‰ì¥ê³  êµ¬ì¡°ëŒ€</title>

  <!-- OG -->
  <meta property="og:title" content="ëƒ‰ì¥ê³  êµ¬ì¡°ëŒ€" />
  <meta property="og:description" content="ëƒ‰ì¥ê³  ì¬ë£Œë¡œ ì§€ê¸ˆ ê°€ëŠ¥í•œ ìš”ë¦¬ë¥¼ êµ¬ì¡°í•©ë‹ˆë‹¤" />
  <meta property="og:image" content="https://dummyimage.com/1200x630/0b1220/ffffff&text=Fridge+Rescue" />

  <!-- Favicon (SVG) -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230b1220'/><text x='50' y='62' font-size='50' text-anchor='middle' fill='white'>ğŸ¥•</text></svg>">

  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; margin:0; background:#f7f7f7; }
    header { background:#0b1220; color:#fff; padding:20px; text-align:center; }
    main { max-width:900px; margin:0 auto; padding:20px; }
    .step { display:none; background:#fff; padding:24px; margin-bottom:20px; border-radius:12px; }
    .step.active { display:block; }
    .step-progress { background:#e5e7eb; height:4px; border-radius:2px; margin-bottom:20px; }
    .step-progress-bar { background:#0b1220; height:100%; border-radius:2px; transition:width 0.3s; }
    .step-label { text-align:center; color:#666; font-size:14px; margin-bottom:16px; }
    h2 { margin-top:0; margin-bottom:16px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px,1fr)); gap:10px; margin-bottom:16px; }
    .category { margin-bottom:24px; }
    .category-title { font-weight:600; color:#333; margin-bottom:12px; font-size:15px; }
    button { padding:12px 16px; border-radius:10px; border:none; background:#0b1220; color:#fff; cursor:pointer; font-size:14px; transition:all 0.2s; }
    button:hover { opacity:0.9; transform:translateY(-1px); }
    button.secondary { background:#e5e7eb; color:#111; }
    button.secondary.active { background:#0b1220; color:#fff; }
    button.next-btn { width:100%; margin-top:16px; padding:14px; font-size:16px; font-weight:600; }
    button.next-btn:disabled { background:#ccc; cursor:not-allowed; opacity:0.6; }
    .card { border:1px solid #e5e7eb; padding:16px; border-radius:12px; margin-bottom:12px; }
    .warn { color:#dc2626; margin-top:8px; font-size:13px; display:none; }
    footer { text-align:center; padding:20px; font-size:14px; color:#666; }
    .footer-link { display:inline-block; padding:10px 20px; background:#0b1220; color:#fff; text-decoration:none; border-radius:8px; font-weight:500; transition:all 0.2s; }
    .footer-link:hover { background:#1a2332; transform:translateY(-2px); box-shadow:0 4px 12px rgba(11,18,32,0.2); }
    .lang-switch { position:absolute; top:20px; right:20px; }
    .lang-switch a { display:inline-block; padding:8px 16px; background:rgba(255,255,255,0.2); color:#fff; text-decoration:none; border-radius:6px; font-size:13px; transition:all 0.2s; }
    .lang-switch a:hover { background:rgba(255,255,255,0.3); }
    header { position:relative; }
  </style>
</head>
<body>

<header>
  <div class="lang-switch">
    <a href="./en.html">ğŸ‡ºğŸ‡¸ English</a>
  </div>
  <h1>ëƒ‰ì¥ê³  êµ¬ì¡°ëŒ€</h1>
  <p>ëƒ‰ì¥ê³ ì— ìˆëŠ” ì¬ë£Œë¡œ ì§€ê¸ˆ ê°€ëŠ¥í•œ ìš”ë¦¬ë¥¼ êµ¬ì¡°í•©ë‹ˆë‹¤</p>
</header>

<main>

<div class="step-progress">
  <div class="step-progress-bar" id="progressBar" style="width:0%"></div>
</div>
<div class="step-label" id="stepLabel">STEP 1 / 3</div>

<!-- STEP 1: ì¬ë£Œ ì„ íƒ -->
<section class="step active" data-step="1">
  <h2>STEP 1. ëƒ‰ì¥ê³ ì— ë­ê°€ ìˆë‚˜ìš”? ğŸ¥•</h2>
  <p style="color:#666; margin-bottom:16px;">ì§€ê¸ˆ ëƒ‰ì¥ê³ ì— ìˆëŠ” ì¬ë£Œë“¤ì„ ì„ íƒí•´ì£¼ì„¸ìš”. ì—¬ëŸ¬ ê°œ ì„ íƒ ê°€ëŠ¥í•´ìš”!</p>
  <div id="ingredients"></div>
  <div class="warn" id="warn1">ì•„ì§ ì¬ë£Œë¥¼ ì„ íƒí•˜ì§€ ì•Šìœ¼ì…¨ì–´ìš”. ìµœì†Œ 1ê°œëŠ” ì„ íƒí•´ì£¼ì„¸ìš”! ğŸ˜Š</div>
  <button class="next-btn" id="nextBtn1" onclick="goNext(1)" disabled>ë‹¤ìŒ ë‹¨ê³„ë¡œ ê°€ê¸° â†’</button>
</section>

<!-- STEP 2: ì˜¤ëŠ˜ì˜ ìƒíƒœ -->
<section class="step" data-step="2">
  <h2>STEP 2. ì˜¤ëŠ˜ ë­˜ ë¨¹ê³  ì‹¶ìœ¼ì„¸ìš”? ğŸ½ï¸</h2>
  <p style="color:#666; margin-bottom:16px;">ì§€ê¸ˆ ê¸°ë¶„ì— ë§ëŠ” ê±¸ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
  <div class="grid">
    <button class="secondary" onclick="setGoal('heavy')">ë“ ë“ í•˜ê²Œ</button>
    <button class="secondary" onclick="setGoal('light')">ê°€ë³ê²Œ</button>
    <button class="secondary" onclick="setGoal('protein')">ë‹¨ë°±ì§ˆ</button>
    <button class="secondary" onclick="setGoal('vitamin')">ì•¼ì±„Â·ë¹„íƒ€ë¯¼</button>
  </div>
</section>

<!-- STEP 3: ë§› ë°©í–¥ -->
<section class="step" data-step="3">
  <h2>STEP 3. ì–´ë–¤ ë§›ì´ ë•¡ê¸°ì„¸ìš”? ğŸ‘…</h2>
  <p style="color:#666; margin-bottom:16px;">ì›í•˜ëŠ” ë§›ì„ ì„ íƒí•´ì£¼ì„¸ìš”!</p>
  <div class="grid">
    <button class="secondary" onclick="setTaste('spicy')">ë§¤ì½¤</button>
    <button class="secondary" onclick="setTaste('mild')">ë‹´ë°±</button>
    <button class="secondary" onclick="setTaste('home')">ì§‘ë°¥</button>
    <button class="secondary" onclick="setTaste('any')">ìƒê´€ì—†ìŒ</button>
  </div>
</section>

<!-- STEP 4: ê²°ê³¼ -->
<section class="step" data-step="4">
  <h2>êµ¬ì¡° ì™„ë£Œ! ì´ ìš”ë¦¬ë“¤ì€ ì–´ë– ì„¸ìš”? ğŸ‰</h2>
  <p style="color:#666; margin-bottom:16px;">ëƒ‰ì¥ê³  ì¬ë£Œë¡œ ì§€ê¸ˆ ë°”ë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ìš”ë¦¬ë“¤ì„ ì°¾ì•„ë´¤ì–´ìš”!</p>
  <div id="result"></div>
  <hr style="margin:20px 0;" />
  <h3>ìµœê·¼ êµ¬ì¡° ê¸°ë¡</h3>
  <div id="history"></div>
  <button onclick="resetSteps()" style="margin-top:16px; background:#666; width:100%;">ğŸ”„ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‹œì‘í•˜ê¸°</button>
</section>

</main>

<footer>
  <a href="https://funnyfunny.cloud" target="_blank" class="footer-link">âœ¨ ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ë³´ê¸°</a>
</footer>

<script>
/* =====================
   ì¬ë£Œ ì‚¬ì „ (ì¹´í…Œê³ ë¦¬ë³„)
===================== */
const ingredientCategories = {
  'ì£¼ì‹ë¥˜': ['ë°¥', 'ë¹µ', 'ë©´', 'ë¼ë©´', 'íŒŒìŠ¤íƒ€ë©´'],
  'ë‹¨ë°±ì§ˆ': ['ë‹¬ê±€', 'ì°¸ì¹˜', 'ì°¸ì¹˜ìº”', 'í–„', 'ë² ì´ì»¨', 'ë‹­ê°€ìŠ´ì‚´', 'ì–´ë¬µ', 'ë¼ì§€ê³ ê¸°', 'ëƒ‰ë™ë§Œë‘'],
  'ì•¼ì±„': ['ê¹€ì¹˜', 'ì–‘íŒŒ', 'ì½©ë‚˜ë¬¼', 'ìƒëŸ¬ë“œì±„ì†Œ', 'ì–‘ë°°ì¶”', 'í† ë§ˆí† ', 'ë‹¹ê·¼', 'ì˜¤ì´', 'íŒŒí”„ë¦¬ì¹´', 'ë²„ì„¯', 'ë¸Œë¡œì½œë¦¬', 'ì• í˜¸ë°•', 'ëŒ€íŒŒ'],
  'ê¸°íƒ€': ['ë‘ë¶€', 'ê°ì', 'ì¹˜ì¦ˆ', 'ëœì¥', 'ìš”ê±°íŠ¸', 'ì˜¤íŠ¸', 'ê³¼ì¼', 'ê²¬ê³¼']
};

/* =====================
   ë ˆì‹œí”¼ DB
===================== */
const recipes = [
  {"id":"R001","name":"ë‹¬ê±€ë³¶ìŒë°¥","required":["ë°¥","ë‹¬ê±€"],"optional":["ëŒ€íŒŒ","ì–‘íŒŒ","í–„","ê¹€ì¹˜"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ ","ê°„ì¥"],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":10,"steps":["íŒ¬ì— ê¸°ë¦„ ë‘ë¥´ê¸°","ë‹¬ê±€ ìŠ¤í¬ë¨ë¸”","ë°¥ ë„£ê³  ë³¶ê¸°","ê°„ì¥/ì†Œê¸ˆ ê°„","íŒŒÂ·í† í•‘ ë„£ê¸°"],"missing_ok":["ëŒ€íŒŒ","í–„"]},
  {"id":"R002","name":"ì°¸ì¹˜ë§ˆìš”ë®ë°¥","required":["ë°¥","ì°¸ì¹˜ìº”"],"optional":["ê¹€","ì–‘íŒŒ","ì˜¤ì´"],"assume":["ë§ˆìš”ë„¤ì¦ˆ","ê°„ì¥","í›„ì¶”"],"macro":{"carb":3,"protein":2,"fat":2,"vitamin":1},"taste":["ì§‘ë°¥","ê³ ê¸°ëŠë‚Œ"],"time":8,"steps":["ì°¸ì¹˜ ê¸°ë¦„ ë¹¼ê¸°","ë§ˆìš”+ê°„ì¥+í›„ì¶” ì„ê¸°","ë°¥ ìœ„ì— ì˜¬ë¦¬ê¸°","ê¹€/ì•¼ì±„ ì–¹ê¸°"],"missing_ok":["ê¹€","ì˜¤ì´"]},
  {"id":"R003","name":"ë‘ë¶€ë¶€ì¹¨(ê°„ì¥ì†ŒìŠ¤)","required":["ë‘ë¶€"],"optional":["ëŒ€íŒŒ","ì–‘íŒŒ"],"assume":["ê°„ì¥","ì‹ìš©ìœ ","ê³ ì¶§ê°€ë£¨","ì‹ì´ˆ"],"macro":{"carb":0,"protein":3,"fat":1,"vitamin":1},"taste":["ë‹´ë°±","ì§‘ë°¥"],"time":12,"steps":["ë‘ë¶€ ë¬¼ê¸° ì œê±°","íŒ¬ì— ë…¸ë¦‡í•˜ê²Œ êµ½ê¸°","ê°„ì¥ì†ŒìŠ¤ ë§Œë“¤ê¸°","ì°ì–´ ë¨¹ê¸°"],"missing_ok":["ê³ ì¶§ê°€ë£¨","ì‹ì´ˆ"]},
  {"id":"R004","name":"ê¹€ì¹˜ë³¶ìŒ","required":["ê¹€ì¹˜"],"optional":["ë¼ì§€ê³ ê¸°","í–„","ì–‘íŒŒ"],"assume":["ì‹ìš©ìœ ","ì„¤íƒ•","ê°„ì¥"],"macro":{"carb":1,"protein":1,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":10,"steps":["ê¹€ì¹˜ ì°ê¸°","íŒ¬ì— ë³¶ê¸°","ë‹¨ë§›/ê°„ ë§ì¶”ê¸°","í† í•‘ ì¶”ê°€ ë³¶ê¸°"],"missing_ok":["ì„¤íƒ•"]},
  {"id":"R005","name":"í† ë§ˆí† ë‹¬ê±€ë³¶ìŒ","required":["ë‹¬ê±€","í† ë§ˆí† "],"optional":["ì–‘íŒŒ","ëŒ€íŒŒ"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ ","í›„ì¶”"],"macro":{"carb":0,"protein":2,"fat":1,"vitamin":3},"taste":["ê¹”ë”","ë‹´ë°±"],"time":10,"steps":["ë‹¬ê±€ ëŒ€ì¶© í’€ê¸°","ë‹¬ê±€ ë¨¼ì € ë³¶ì•„ êº¼ë‚´ê¸°","í† ë§ˆí†  ë³¶ê¸°","ë‹¬ê±€ ë‹¤ì‹œ í•©ì¹˜ê¸°","ì†Œê¸ˆ/í›„ì¶”"],"missing_ok":["ì–‘íŒŒ"]},
  {"id":"R006","name":"ê°ìì±„ì „","required":["ê°ì"],"optional":["ì–‘íŒŒ","ë‹¬ê±€"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ "],"macro":{"carb":3,"protein":1,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":15,"steps":["ê°ì ì±„ ì°ê¸°","ë¬¼ì— í—¹ê¶ˆ ì „ë¶„ ì¡°ì ˆ","ì†Œê¸ˆ ê°„","íŒ¬ì— ë„“ê²Œ ë¶€ì¹˜ê¸°","ë’¤ì§‘ì–´ ë…¸ë¦‡í•˜ê²Œ"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R007","name":"ê°ìë²„í„°êµ¬ì´","required":["ê°ì"],"optional":["íŒŒìŠ¬ë¦¬","ì¹˜ì¦ˆ"],"assume":["ë²„í„°","ì†Œê¸ˆ","í›„ì¶”"],"macro":{"carb":3,"protein":0,"fat":2,"vitamin":1},"taste":["ê³ ê¸°ëŠë‚Œ","ë‹´ë°±"],"time":18,"steps":["ê°ì ì „ìë ˆì¸ì§€ë¡œ ìµíˆê¸°","íŒ¬ì— ë²„í„° ë…¹ì´ê¸°","ê°ì ë„£ê³  êµ½ê¸°","ì†Œê¸ˆ/í›„ì¶”","ì¹˜ì¦ˆ ì˜µì…˜"],"missing_ok":["ì¹˜ì¦ˆ"]},
  {"id":"R008","name":"ë‘ë¶€ìŠ¤í¬ë¨ë¸”","required":["ë‘ë¶€"],"optional":["ì–‘íŒŒ","íŒŒí”„ë¦¬ì¹´","ë²„ì„¯"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ ","í›„ì¶”"],"macro":{"carb":0,"protein":3,"fat":1,"vitamin":2},"taste":["ê¹”ë”","ë‹´ë°±"],"time":10,"steps":["ë‘ë¶€ ìœ¼ê¹¨ê¸°","ì•¼ì±„ ë³¶ê¸°","ë‘ë¶€ ë„£ê³  ë³¶ê¸°","ì†Œê¸ˆ/í›„ì¶” ê°„"],"missing_ok":["ë²„ì„¯","íŒŒí”„ë¦¬ì¹´"]},
  {"id":"R009","name":"ê³„ë€ì°œ(ì „ìë ˆì¸ì§€)","required":["ë‹¬ê±€"],"optional":["ëŒ€íŒŒ","ìš°ìœ "],"assume":["ì†Œê¸ˆ","ì°¸ê¸°ë¦„"],"macro":{"carb":0,"protein":2,"fat":1,"vitamin":1},"taste":["ë‹´ë°±","ì§‘ë°¥"],"time":7,"steps":["ë‹¬ê±€ í’€ê¸°","ë¬¼/ìš°ìœ  ì•½ê°„","ì†Œê¸ˆ ê°„","ì „ìë ˆì¸ì§€ 2~3íšŒ ë‚˜ëˆ  ê°€ì—´","ì°¸ê¸°ë¦„/íŒŒ"],"missing_ok":["ìš°ìœ "]},
  {"id":"R010","name":"ì•¼ì±„ê³„ë€ë§ì´","required":["ë‹¬ê±€"],"optional":["ë‹¹ê·¼","ì–‘íŒŒ","ëŒ€íŒŒ"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ "],"macro":{"carb":0,"protein":2,"fat":1,"vitamin":2},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":12,"steps":["ì•¼ì±„ ì˜ê²Œ ì°ê¸°","ë‹¬ê±€ì— ì„ê¸°","íŒ¬ì— ì–‡ê²Œ ë¶€ì¹˜ë©° ë§ê¸°","í•œê¹€ ì‹í˜€ ì°ê¸°"],"missing_ok":["ë‹¹ê·¼"]},
  {"id":"R011","name":"ê¹€ì¹˜ì°Œê°œ(ì´ˆê°„ë‹¨)","required":["ê¹€ì¹˜"],"optional":["ë¼ì§€ê³ ê¸°","ë‘ë¶€","ëŒ€íŒŒ"],"assume":["ë¬¼","ê³ ì¶§ê°€ë£¨","ê°„ì¥"],"macro":{"carb":1,"protein":2,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":20,"steps":["ê¹€ì¹˜ ë³¶ê¸°","ë¬¼ ë¶“ê¸°","ê°„ ë§ì¶”ê¸°","ë‘ë¶€/ê³ ê¸° ë„£ê¸°","íŒŒë¡œ ë§ˆë¬´ë¦¬"],"missing_ok":["ë¼ì§€ê³ ê¸°"]},
  {"id":"R012","name":"ëœì¥êµ­(ë§‘ê²Œ)","required":["ëœì¥"],"optional":["ë‘ë¶€","ì–‘íŒŒ","ê°ì","ì• í˜¸ë°•"],"assume":["ë¬¼","ë§ˆëŠ˜"],"macro":{"carb":1,"protein":2,"fat":0,"vitamin":2},"taste":["ê¹”ë”","ì§‘ë°¥"],"time":18,"steps":["ë¬¼ ë“ì´ê¸°","ëœì¥ í’€ê¸°","ì¬ë£Œ ë„£ê¸°","í•œì†Œë”","ê°„ ì¡°ì ˆ"],"missing_ok":["ë§ˆëŠ˜"]},
  {"id":"R013","name":"ì–‘ë°°ì¶”ë³¶ìŒ","required":["ì–‘ë°°ì¶”"],"optional":["í–„","ì–‘íŒŒ"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ ","ê°„ì¥"],"macro":{"carb":1,"protein":1,"fat":1,"vitamin":3},"taste":["ê¹”ë”","ë‹´ë°±"],"time":10,"steps":["ì–‘ë°°ì¶” ì°ê¸°","ì„¼ë¶ˆì— ë¹ ë¥´ê²Œ ë³¶ê¸°","ì†Œê¸ˆ/ê°„ì¥ ê°„","í† í•‘ ë„£ê¸°"],"missing_ok":["í–„"]},
  {"id":"R014","name":"ë‹­ê°€ìŠ´ì‚´ì•¼ì±„ë³¶ìŒ","required":["ë‹­ê°€ìŠ´ì‚´"],"optional":["ì–‘íŒŒ","íŒŒí”„ë¦¬ì¹´","ë¸Œë¡œì½œë¦¬"],"assume":["ì†Œê¸ˆ","í›„ì¶”","ì‹ìš©ìœ "],"macro":{"carb":0,"protein":3,"fat":1,"vitamin":2},"taste":["ê¹”ë”","ê³ ê¸°ëŠë‚Œ"],"time":15,"steps":["ë‹­ê°€ìŠ´ì‚´ í•œì…ì»·","ì•¼ì±„ ì¤€ë¹„","ë‹­ ë¨¼ì € êµ½ê¸°","ì•¼ì±„ ë„£ê³  ë³¶ê¸°","ì†Œê¸ˆ/í›„ì¶”"],"missing_ok":["ë¸Œë¡œì½œë¦¬"]},
  {"id":"R015","name":"ì˜¤íŠ¸/ìš”ê±°íŠ¸ë³¼","required":["ìš”ê±°íŠ¸"],"optional":["ì˜¤íŠ¸","ê³¼ì¼","ê²¬ê³¼"],"assume":["ê¿€"],"macro":{"carb":2,"protein":2,"fat":1,"vitamin":2},"taste":["ê¹”ë”"],"time":5,"steps":["ìš”ê±°íŠ¸ ë‹´ê¸°","ì˜¤íŠ¸/ê³¼ì¼ ì˜¬ë¦¬ê¸°","ê²¬ê³¼ ë¿Œë¦¬ê¸°","ê¿€ í•œ ë°”í€´"],"missing_ok":["ì˜¤íŠ¸","ê²¬ê³¼"]},
  {"id":"R016","name":"íŒŒìŠ¤íƒ€ ì•Œë¦¬ì˜¤ì˜¬ë¦¬ì˜¤(ì´ˆê°„ë‹¨)","required":["íŒŒìŠ¤íƒ€ë©´"],"optional":["ë§ˆëŠ˜","ë² ì´ì»¨","í˜í¼ë¡ ì¹˜ë…¸"],"assume":["ì˜¬ë¦¬ë¸Œì˜¤ì¼","ì†Œê¸ˆ","í›„ì¶”"],"macro":{"carb":3,"protein":1,"fat":2,"vitamin":0},"taste":["ê¹”ë”","ê³ ê¸°ëŠë‚Œ"],"time":15,"steps":["ë©´ ì‚¶ê¸°","ì˜¤ì¼ì— ë§ˆëŠ˜ ë³¶ê¸°","ë©´ ë„£ê³  ë³¶ê¸°","ì†Œê¸ˆ/í›„ì¶”","í† í•‘"],"missing_ok":["ë² ì´ì»¨","í˜í¼ë¡ ì¹˜ë…¸"]},
  {"id":"R017","name":"ë¹„ë¹”êµ­ìˆ˜(ê°„ë‹¨)","required":["ë©´"],"optional":["ì˜¤ì´","ê¹€ì¹˜","ë‹¬ê±€"],"assume":["ê³ ì¶”ì¥","ì‹ì´ˆ","ì„¤íƒ•","ê°„ì¥"],"macro":{"carb":3,"protein":1,"fat":0,"vitamin":2},"taste":["ë§¤ì½¤"],"time":12,"steps":["ë©´ ì‚¶ê¸°","ì–‘ë…ì¥ ë§Œë“¤ê¸°","ë©´+ì–‘ë… ë¹„ë¹„ê¸°","í† í•‘ ì˜¬ë¦¬ê¸°"],"missing_ok":["ì˜¤ì´","ë‹¬ê±€"]},
  {"id":"R018","name":"ë§Œë‘êµ­","required":["ëƒ‰ë™ë§Œë‘"],"optional":["ëŒ€íŒŒ","ë‹¬ê±€"],"assume":["ë¬¼","ê°„ì¥","ì†Œê¸ˆ"],"macro":{"carb":2,"protein":2,"fat":2,"vitamin":1},"taste":["ì§‘ë°¥"],"time":12,"steps":["ë¬¼ ë“ì´ê¸°","ë§Œë‘ ë„£ê¸°","ê°„ ë§ì¶”ê¸°","ë‹¬ê±€ í’€ê¸°(ì˜µì…˜)","íŒŒ"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R019","name":"í–„ê°ìë³¶ìŒ","required":["ê°ì"],"optional":["í–„","ì–‘íŒŒ","ë‹¹ê·¼"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ ","ê°„ì¥"],"macro":{"carb":3,"protein":1,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥","ê³ ê¸°ëŠë‚Œ"],"time":15,"steps":["ê°ì ì±„ ì°ê¸°","ê°ì ë¨¼ì € ë³¶ê¸°","í–„/ì•¼ì±„ ë„£ê¸°","ê°„ ë§ì¶”ê¸°"],"missing_ok":["ë‹¹ê·¼"]},
  {"id":"R020","name":"ì˜¤ë¯ˆë ›(ëƒ‰ì¥ê³ í„¸ì´)","required":["ë‹¬ê±€"],"optional":["ì¹˜ì¦ˆ","í–„","ì–‘íŒŒ","ë²„ì„¯"],"assume":["ì†Œê¸ˆ","ë²„í„°","í›„ì¶”"],"macro":{"carb":0,"protein":2,"fat":2,"vitamin":1},"taste":["ë‹´ë°±","ê³ ê¸°ëŠë‚Œ"],"time":12,"steps":["ì†ì¬ë£Œ ë³¶ê¸°","ë‹¬ê±€ í’€ê¸°","íŒ¬ì— ë¶€ì–´ ìµíˆê¸°","ì ‘ì–´ ë§ˆë¬´ë¦¬"],"missing_ok":["ì¹˜ì¦ˆ"]},
  {"id":"R021","name":"ë‘ë¶€ê¹€ì¹˜","required":["ë‘ë¶€","ê¹€ì¹˜"],"optional":["ë¼ì§€ê³ ê¸°","ëŒ€íŒŒ"],"assume":["ì‹ìš©ìœ ","ì„¤íƒ•"],"macro":{"carb":1,"protein":3,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":15,"steps":["ë‘ë¶€ ë°ì¹˜ê¸°","ê¹€ì¹˜ ë³¶ê¸°","ì ‘ì‹œì— ë‹´ê¸°","í•¨ê»˜ ë¨¹ê¸°"],"missing_ok":["ë¼ì§€ê³ ê¸°"]},
  {"id":"R022","name":"ê°„ì¥ê³„ë€ë°¥","required":["ë°¥","ë‹¬ê±€"],"optional":["ë²„í„°","ê¹€"],"assume":["ê°„ì¥","ì°¸ê¸°ë¦„"],"macro":{"carb":3,"protein":2,"fat":2,"vitamin":0},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":5,"steps":["ë”°ëœ»í•œ ë°¥ ì¤€ë¹„","ë‹¬ê±€ ì˜¬ë¦¬ê¸°","ê°„ì¥+ì°¸ê¸°ë¦„","ì˜ ë¹„ë¹„ê¸°","ê¹€"],"missing_ok":["ë²„í„°","ê¹€"]},
  {"id":"R023","name":"ìƒëŸ¬ë“œ+ë‹¨ë°±ì§ˆ í† í•‘","required":["ìƒëŸ¬ë“œì±„ì†Œ"],"optional":["ë‹­ê°€ìŠ´ì‚´","ë‹¬ê±€","ì°¸ì¹˜ìº”","ìš”ê±°íŠ¸"],"assume":["ì†Œê¸ˆ","ì˜¬ë¦¬ë¸Œì˜¤ì¼","ì‹ì´ˆ"],"macro":{"carb":0,"protein":2,"fat":1,"vitamin":3},"taste":["ê¹”ë”"],"time":8,"steps":["ì±„ì†Œ ì”»ê¸°","í† í•‘ ì¤€ë¹„","ë“œë ˆì‹± ë§Œë“¤ê¸°","ì„ì–´ ë¨¹ê¸°"],"missing_ok":["ì˜¬ë¦¬ë¸Œì˜¤ì¼"]},
  {"id":"R024","name":"ê³ ì¶”ì¥ë¼ì§€ë³¶ìŒ(ê°„ë‹¨)","required":["ë¼ì§€ê³ ê¸°"],"optional":["ì–‘íŒŒ","ëŒ€íŒŒ","ì–‘ë°°ì¶”"],"assume":["ê³ ì¶”ì¥","ê°„ì¥","ì„¤íƒ•","ë§ˆëŠ˜","ì‹ìš©ìœ "],"macro":{"carb":1,"protein":3,"fat":2,"vitamin":2},"taste":["ë§¤ì½¤","ê³ ê¸°ëŠë‚Œ"],"time":15,"steps":["ê³ ê¸° ë³¶ê¸°","ì•¼ì±„ ë„£ê¸°","ì–‘ë… ë„£ê³  ë³¶ê¸°","ê°„ ì¡°ì ˆ"],"missing_ok":["ì–‘ë°°ì¶”"]},
  {"id":"R025","name":"ì–´ë¬µë³¶ìŒ","required":["ì–´ë¬µ"],"optional":["ì–‘íŒŒ","ëŒ€íŒŒ","ë‹¹ê·¼"],"assume":["ê°„ì¥","ì„¤íƒ•","ì‹ìš©ìœ "],"macro":{"carb":1,"protein":2,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥"],"time":10,"steps":["ì–´ë¬µ ì°ê¸°","ì•¼ì±„ ë³¶ê¸°","ì–´ë¬µ ë„£ê¸°","ê°„ì¥/ì„¤íƒ• ê°„"],"missing_ok":["ë‹¹ê·¼"]},
  {"id":"R026","name":"ì¹˜ì¦ˆí† ìŠ¤íŠ¸(ì´ˆê°„ë‹¨)","required":["ë¹µ","ì¹˜ì¦ˆ"],"optional":["í–„","ë‹¬ê±€"],"assume":["ë²„í„°"],"macro":{"carb":2,"protein":2,"fat":2,"vitamin":0},"taste":["ê³ ê¸°ëŠë‚Œ","ë‹´ë°±"],"time":7,"steps":["ë¹µ êµ½ê¸°","ì¹˜ì¦ˆ/í† í•‘ ì˜¬ë¦¬ê¸°","ë…¹ì„ ë•Œê¹Œì§€ ê°€ì—´","ì™„ì„±"],"missing_ok":["í–„"]},
  {"id":"R027","name":"ê¹€ì¹˜ë³¶ìŒë°¥","required":["ë°¥","ê¹€ì¹˜"],"optional":["ë‹¬ê±€","í–„","ì¹˜ì¦ˆ"],"assume":["ì‹ìš©ìœ ","ê°„ì¥"],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":12,"steps":["ê¹€ì¹˜ ë³¶ê¸°","ë°¥ ë„£ê³  ë³¶ê¸°","ê°„ ë§ì¶”ê¸°","ë‹¬ê±€/ì¹˜ì¦ˆ ì¶”ê°€"],"missing_ok":["ì¹˜ì¦ˆ"]},
  {"id":"R028","name":"ì½©ë‚˜ë¬¼êµ­(ê°„ë‹¨)","required":["ì½©ë‚˜ë¬¼"],"optional":["ëŒ€íŒŒ","ë‹¬ê±€"],"assume":["ë¬¼","ì†Œê¸ˆ","ë§ˆëŠ˜"],"macro":{"carb":0,"protein":1,"fat":0,"vitamin":3},"taste":["ê¹”ë”","ì§‘ë°¥"],"time":15,"steps":["ë¬¼ ë“ì´ê¸°","ì½©ë‚˜ë¬¼ ë„£ê¸°","ì†Œê¸ˆ/ë§ˆëŠ˜","íŒŒë¡œ ë§ˆë¬´ë¦¬"],"missing_ok":["ë§ˆëŠ˜"]},
  {"id":"R029","name":"ê°„ì¥ë²„í„°ê°ìë°¥(ê°ì ë®ë°¥)","required":["ê°ì","ë°¥"],"optional":["ë‹¬ê±€","ì–‘íŒŒ"],"assume":["ê°„ì¥","ë²„í„°","í›„ì¶”"],"macro":{"carb":3,"protein":1,"fat":2,"vitamin":1},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":15,"steps":["ê°ì ì˜ê²Œ ì°ê¸°","íŒ¬ì— ìµíˆê¸°","ê°„ì¥/ë²„í„° ë„£ê¸°","ë°¥ ìœ„ì— ì˜¬ë¦¬ê¸°"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R030","name":"ì•¼ì±„ë¼ë©´(ì—…ê·¸ë ˆì´ë“œ)","required":["ë¼ë©´"],"optional":["ì–‘íŒŒ","ëŒ€íŒŒ","ë‹¬ê±€","ê¹€ì¹˜"],"assume":["ë¬¼"],"macro":{"carb":3,"protein":1,"fat":2,"vitamin":1},"taste":["ë§¤ì½¤"],"time":8,"steps":["ë¬¼ ë“ì´ê¸°","ì•¼ì±„ ë¨¼ì € ë„£ê¸°","ë©´/ìŠ¤í”„","ë‹¬ê±€ ë„£ê¸°","íŒŒ/ê¹€ì¹˜"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R041","name":"ê³„ë€í›„ë¼ì´ë°¥","required":["ë°¥","ë‹¬ê±€"],"optional":["ê¹€","ë²„í„°"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ "],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":0},"taste":["ì§‘ë°¥","ë‹´ë°±"],"time":5,"steps":["ë‹¬ê±€ í›„ë¼ì´","ë°¥ ìœ„ì— ì˜¬ë¦¬ê¸°","ê°„ì¥/ì†Œê¸ˆ","ê¹€"],"missing_ok":["ê¹€"]},
  {"id":"R042","name":"ê¹€ì¹˜ê³„ë€ë°¥","required":["ë°¥","ê¹€ì¹˜","ë‹¬ê±€"],"optional":["ì°¸ê¸°ë¦„"],"assume":["ì‹ìš©ìœ "],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":8,"steps":["ê¹€ì¹˜ ë³¶ê¸°","ë‹¬ê±€ ìŠ¤í¬ë¨ë¸”","ë°¥ ë„£ê³  ë³¶ê¸°","ì°¸ê¸°ë¦„"],"missing_ok":[]},
  {"id":"R043","name":"ë‘ë¶€ê¹€ë°¥","required":["ë°¥","ë‘ë¶€"],"optional":["ê¹€","ë‹¹ê·¼","ì˜¤ì´"],"assume":["ì†Œê¸ˆ","ì°¸ê¸°ë¦„"],"macro":{"carb":3,"protein":3,"fat":1,"vitamin":1},"taste":["ë‹´ë°±","ì§‘ë°¥"],"time":15,"steps":["ë‘ë¶€ ë°ì¹˜ê¸°","ë°¥ ì¤€ë¹„","ê¹€ì— ë°¥/ë‘ë¶€ ì˜¬ë¦¬ê¸°","ë§ê¸°"],"missing_ok":["ë‹¹ê·¼","ì˜¤ì´"]},
  {"id":"R044","name":"ë² ì´ì»¨ì—ê·¸","required":["ë² ì´ì»¨","ë‹¬ê±€"],"optional":["ë¹µ","ì¹˜ì¦ˆ"],"assume":["ì†Œê¸ˆ","í›„ì¶”"],"macro":{"carb":1,"protein":2,"fat":2,"vitamin":0},"taste":["ê³ ê¸°ëŠë‚Œ","ë‹´ë°±"],"time":10,"steps":["ë² ì´ì»¨ êµ½ê¸°","ë‹¬ê±€ í›„ë¼ì´","ì†Œê¸ˆ/í›„ì¶”","ë¹µì— ì˜¬ë¦¬ê¸°"],"missing_ok":["ë¹µ"]},
  {"id":"R045","name":"ì½©ë‚˜ë¬¼ë°¥","required":["ë°¥","ì½©ë‚˜ë¬¼"],"optional":["ë‹¬ê±€","ëŒ€íŒŒ"],"assume":["ì†Œê¸ˆ","ì°¸ê¸°ë¦„"],"macro":{"carb":3,"protein":1,"fat":0,"vitamin":3},"taste":["ê¹”ë”","ì§‘ë°¥"],"time":12,"steps":["ì½©ë‚˜ë¬¼ ë³¶ê¸°","ë°¥ ë„£ê³  ë³¶ê¸°","ì†Œê¸ˆ ê°„","ì°¸ê¸°ë¦„/íŒŒ"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R046","name":"ì–´ë¬µíƒ•","required":["ì–´ë¬µ"],"optional":["ëŒ€íŒŒ","ë‹¬ê±€","ë¼ë©´"],"assume":["ë¬¼","ì†Œê¸ˆ","ê°„ì¥"],"macro":{"carb":1,"protein":2,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥"],"time":10,"steps":["ë¬¼ ë“ì´ê¸°","ì–´ë¬µ ë„£ê¸°","ê°„ ë§ì¶”ê¸°","íŒŒ/ë‹¬ê±€"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R047","name":"ì¹˜ì¦ˆê³„ë€ë§ì´","required":["ë‹¬ê±€","ì¹˜ì¦ˆ"],"optional":["í–„","ì–‘íŒŒ"],"assume":["ì†Œê¸ˆ","ì‹ìš©ìœ "],"macro":{"carb":0,"protein":2,"fat":2,"vitamin":0},"taste":["ê³ ê¸°ëŠë‚Œ","ë‹´ë°±"],"time":10,"steps":["ë‹¬ê±€ í’€ê¸°","ì¹˜ì¦ˆ ë„£ê¸°","íŒ¬ì— ë¶€ì¹˜ë©° ë§ê¸°","í† í•‘ ì¶”ê°€"],"missing_ok":["í–„"]},
  {"id":"R048","name":"ê°ììŠ¤í”„","required":["ê°ì"],"optional":["ì–‘íŒŒ","ìš°ìœ "],"assume":["ì†Œê¸ˆ","ë²„í„°"],"macro":{"carb":3,"protein":0,"fat":1,"vitamin":2},"taste":["ë‹´ë°±"],"time":20,"steps":["ê°ì ìµíˆê¸°","ìœ¼ê¹¨ê¸°","ìš°ìœ  ë„£ê¸°","ê°„ ë§ì¶”ê¸°"],"missing_ok":["ìš°ìœ "]},
  {"id":"R049","name":"ê¹€ì¹˜ë‘ë¶€êµ­","required":["ê¹€ì¹˜","ë‘ë¶€"],"optional":["ëŒ€íŒŒ","ë¼ì§€ê³ ê¸°"],"assume":["ë¬¼","ê³ ì¶§ê°€ë£¨"],"macro":{"carb":1,"protein":3,"fat":1,"vitamin":2},"taste":["ë§¤ì½¤","ì§‘ë°¥"],"time":15,"steps":["ê¹€ì¹˜ ë³¶ê¸°","ë¬¼ ë¶“ê¸°","ë‘ë¶€ ë„£ê¸°","ê°„ ë§ì¶”ê¸°"],"missing_ok":["ë¼ì§€ê³ ê¸°"]},
  {"id":"R050","name":"ì•¼ì±„ë³¶ìŒë°¥","required":["ë°¥"],"optional":["ì–‘íŒŒ","ë‹¹ê·¼","ì–‘ë°°ì¶”","ë‹¬ê±€"],"assume":["ì‹ìš©ìœ ","ì†Œê¸ˆ","ê°„ì¥"],"macro":{"carb":3,"protein":1,"fat":1,"vitamin":2},"taste":["ê¹”ë”","ì§‘ë°¥"],"time":12,"steps":["ì•¼ì±„ ë³¶ê¸°","ë°¥ ë„£ê³  ë³¶ê¸°","ê°„ ë§ì¶”ê¸°","ë‹¬ê±€ ì¶”ê°€"],"missing_ok":["ë‹¹ê·¼"]},
  {"id":"R051","name":"ì°¸ì¹˜ê¹€ë°¥","required":["ë°¥","ì°¸ì¹˜ìº”"],"optional":["ê¹€","ì˜¤ì´","ë‹¹ê·¼"],"assume":["ì°¸ê¸°ë¦„","ì†Œê¸ˆ"],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥"],"time":15,"steps":["ì°¸ì¹˜ ê¸°ë¦„ ë¹¼ê¸°","ë°¥ ì¤€ë¹„","ê¹€ì— ë°¥/ì°¸ì¹˜ ì˜¬ë¦¬ê¸°","ë§ê¸°"],"missing_ok":["ì˜¤ì´"]},
  {"id":"R052","name":"ë‹¬ê±€êµ­ìˆ˜","required":["ë©´","ë‹¬ê±€"],"optional":["ëŒ€íŒŒ","ê¹€ì¹˜"],"assume":["ë¬¼","ì†Œê¸ˆ"],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":1},"taste":["ë‹´ë°±","ì§‘ë°¥"],"time":10,"steps":["ë¬¼ ë“ì´ê¸°","ë©´ ë„£ê¸°","ë‹¬ê±€ í’€ê¸°","íŒŒ/ê¹€ì¹˜"],"missing_ok":["ê¹€ì¹˜"]},
  {"id":"R053","name":"ì¹˜ì¦ˆë¼ë©´","required":["ë¼ë©´","ì¹˜ì¦ˆ"],"optional":["ë‹¬ê±€","ëŒ€íŒŒ"],"assume":["ë¬¼"],"macro":{"carb":3,"protein":2,"fat":3,"vitamin":0},"taste":["ê³ ê¸°ëŠë‚Œ","ë§¤ì½¤"],"time":8,"steps":["ë¼ë©´ ë“ì´ê¸°","ì¹˜ì¦ˆ ë„£ê¸°","ë‹¬ê±€ ë„£ê¸°","íŒŒ"],"missing_ok":["ë‹¬ê±€"]},
  {"id":"R054","name":"ë‘ë¶€ë³¶ìŒë°¥","required":["ë°¥","ë‘ë¶€"],"optional":["ì–‘íŒŒ","ëŒ€íŒŒ"],"assume":["ì‹ìš©ìœ ","ê°„ì¥","ì†Œê¸ˆ"],"macro":{"carb":3,"protein":3,"fat":1,"vitamin":1},"taste":["ë‹´ë°±","ì§‘ë°¥"],"time":12,"steps":["ë‘ë¶€ ìœ¼ê¹¨ê¸°","ë°¥ ë„£ê³  ë³¶ê¸°","ê°„ì¥/ì†Œê¸ˆ ê°„","íŒŒ"],"missing_ok":["ì–‘íŒŒ"]},
  {"id":"R055","name":"í–„ë³¶ìŒë°¥","required":["ë°¥","í–„"],"optional":["ì–‘íŒŒ","ë‹¬ê±€","ì¹˜ì¦ˆ"],"assume":["ì‹ìš©ìœ ","ê°„ì¥"],"macro":{"carb":3,"protein":2,"fat":1,"vitamin":1},"taste":["ì§‘ë°¥","ê³ ê¸°ëŠë‚Œ"],"time":10,"steps":["í–„ ë³¶ê¸°","ë°¥ ë„£ê³  ë³¶ê¸°","ê°„ì¥ ê°„","ë‹¬ê±€/ì¹˜ì¦ˆ ì¶”ê°€"],"missing_ok":["ì¹˜ì¦ˆ"]}
];

/* =====================
   ìƒíƒœê°’
===================== */
let currentStep = 1;
let selectedIngredients = JSON.parse(localStorage.getItem('fridge.ingredients')||'[]');
let goal = localStorage.getItem('fridge.goal') || null;
let taste = localStorage.getItem('fridge.taste') || null;
let favorites = JSON.parse(localStorage.getItem('fridge.favorites')||'[]');
let history = JSON.parse(localStorage.getItem('fridge.history')||'[]');

/* =====================
   UI ìƒì„±
===================== */
function renderIngredients() {
  const ingWrap = document.getElementById('ingredients');
  ingWrap.innerHTML = '';
  
  Object.entries(ingredientCategories).forEach(([category, items]) => {
    const categoryDiv = document.createElement('div');
    categoryDiv.className = 'category';
    
    const title = document.createElement('div');
    title.className = 'category-title';
    title.textContent = category;
    categoryDiv.appendChild(title);
    
    const grid = document.createElement('div');
    grid.className = 'grid';
    
    items.forEach(i => {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.className = 'secondary';
      if(selectedIngredients.includes(i)) btn.classList.add('active');
      btn.onclick = () => {
        btn.classList.toggle('active');
        if (selectedIngredients.includes(i)) {
          selectedIngredients = selectedIngredients.filter(x => x !== i);
        } else {
          selectedIngredients.push(i);
        }
        localStorage.setItem('fridge.ingredients', JSON.stringify(selectedIngredients));
        updateNextButton(1);
        hideWarn(1);
      };
      grid.appendChild(btn);
    });
    
    categoryDiv.appendChild(grid);
    ingWrap.appendChild(categoryDiv);
  });
}

function showStep(n) {
  currentStep = n;
  document.querySelectorAll('.step').forEach(s => {
    s.classList.toggle('active', Number(s.dataset.step) === n);
  });
  
  const progress = Math.round(((n - 1) / 3) * 100);
  document.getElementById('progressBar').style.width = progress + '%';
  
  // STEP 4ëŠ” ê²°ê³¼ í™”ë©´ì´ë¯€ë¡œ ë‹¤ë¥¸ í…ìŠ¤íŠ¸ í‘œì‹œ
  if(n === 4) {
    const funMessages = [
      'ğŸš€ êµ¬ì¡°í•˜ëŸ¬ ê°€ë³¼ê¹Œìš”?',
      'ğŸ¯ ëƒ‰ì¥ê³  êµ¬ì¡° ì‘ì „ ì‹œì‘!',
      'ğŸ³ ì§€ê¸ˆ ë°”ë¡œ ìš”ë¦¬ ì‹œì‘í•´ë³¼ê¹Œìš”?',
      'âœ¨ ìš”ë¦¬í•  ì¤€ë¹„ ëì–´ìš”!',
      'ğŸ‰ ëƒ‰ì¥ê³  êµ¬ì¡° ì„±ê³µ!',
      'ğŸ‘¨â€ğŸ³ ìš”ë¦¬ì‚¬ ëª¨ë“œ ON!',
      'ğŸ”¥ ì§€ê¸ˆ ìš”ë¦¬í•˜ë©´ ë”±ì´ì—ìš”!'
    ];
    document.getElementById('stepLabel').textContent = funMessages[Math.floor(Math.random() * funMessages.length)];
    document.getElementById('progressBar').style.width = '100%';
  } else {
    document.getElementById('stepLabel').textContent = `STEP ${n} / 3`;
  }
  
  // STEP 2, 3ì€ ì„ íƒëœ ë²„íŠ¼ í‘œì‹œ
  if(n === 2) updateGoalButtons();
  if(n === 3) updateTasteButtons();
  
  // STEP 4ëŠ” ìë™ìœ¼ë¡œ ê²°ê³¼ í‘œì‹œ
  if(n === 4) {
    recommend();
  }
}

function updateGoalButtons() {
  document.querySelectorAll('[data-step="2"] .secondary').forEach(btn => {
    btn.classList.remove('active');
  });
  if(goal) {
    const btn = [...document.querySelectorAll('[data-step="2"] .secondary')]
      .find(b => b.onclick.toString().includes(`'${goal}'`));
    if(btn) btn.classList.add('active');
  }
}

function updateTasteButtons() {
  document.querySelectorAll('[data-step="3"] .secondary').forEach(btn => {
    btn.classList.remove('active');
  });
  if(taste) {
    const btn = [...document.querySelectorAll('[data-step="3"] .secondary')]
      .find(b => b.onclick.toString().includes(`'${taste}'`));
    if(btn) btn.classList.add('active');
  }
}

function setGoal(g) {
  goal = g;
  localStorage.setItem('fridge.goal', g);
  updateGoalButtons();
  setTimeout(() => goNext(2), 300);
}

function setTaste(t) {
  taste = t;
  localStorage.setItem('fridge.taste', t);
  updateTasteButtons();
  setTimeout(() => goNext(3), 300);
}

function updateNextButton(step) {
  if(step === 1) {
    const btn = document.getElementById('nextBtn1');
    btn.disabled = selectedIngredients.length === 0;
  }
}

function hideWarn(step) {
  const warn = document.getElementById(`warn${step}`);
  if(warn) warn.style.display = 'none';
}

function goNext(step) {
  if(step === 1) {
    if(selectedIngredients.length === 0) {
      document.getElementById('warn1').style.display = 'block';
      return;
    }
  }
  showStep(step + 1);
}

function resetSteps() {
  currentStep = 1;
  goal = null;
  taste = null;
  selectedIngredients = [];
  localStorage.removeItem('fridge.ingredients');
  localStorage.removeItem('fridge.goal');
  localStorage.removeItem('fridge.taste');
  renderIngredients();
  showStep(1);
}

/* =====================
   ì¶”ì²œ ë¡œì§
===================== */
function scoreRecipe(r){
  // í•„ìˆ˜ ì¬ë£Œ ì²´í¬ (ì°¸ì¹˜ìº”ì€ ì°¸ì¹˜ë¡œë„ ì¸ì •)
  for(const req of r.required){
    if(req === 'ì°¸ì¹˜ìº”') {
      if(!selectedIngredients.includes('ì°¸ì¹˜ìº”') && !selectedIngredients.includes('ì°¸ì¹˜')) {
        return -1;
      }
    } else {
      if(!selectedIngredients.includes(req)) {
        return -1;
      }
    }
  }
  let score = 10;

  // ì˜ì–‘ ê°€ì¤‘ì¹˜
  if(goal==='protein') score += r.macro.protein * 3;
  if(goal==='vitamin') score += r.macro.vitamin * 3;
  if(goal==='light') score += r.macro.fat * -1;

  // ë§› ë§¤í•‘ (í•œê¸€ -> ì˜ë¬¸)
  const tasteMap = {
    'spicy': ['ë§¤ì½¤', 'spicy'],
    'mild': ['ë‹´ë°±', 'mild'],
    'home': ['ì§‘ë°¥', 'home'],
    'any': ['ìƒê´€ì—†ìŒ', 'any']
  };
  
  // ë§› ë§¤ì¹­ ì²´í¬
  if(taste && taste !== 'any') {
    const matched = r.taste.some(t => {
      if(tasteMap[taste]) {
        return tasteMap[taste].includes(t);
      }
      return t === taste;
    });
    if(matched) score += 5;
  }

  // ì‹œê°„
  if(r.time <= 10) score += 3;

  return score;
}

function getReason(r){
  const reasons = {
    'protein': ['ë‹¨ë°±ì§ˆ ë³´ì¶©í•˜ê¸° ë”± ì¢‹ì•„ìš”! ğŸ’ª', 'ê·¼ìœ¡ ë§Œë“¤ê¸°ì— ìµœê³ ì˜ˆìš”!', 'ë‹¨ë°±ì§ˆ ë“¬ë¿ ë“¤ì–´ìˆì–´ìš”'],
    'vitamin': ['ì•¼ì±„Â·ë¹„íƒ€ë¯¼ ê°€ë“í•´ìš”! ğŸ¥¬', 'ê±´ê°•í•˜ê²Œ ë¨¹ê¸° ì¢‹ì•„ìš”', 'ë¹„íƒ€ë¯¼ ì¶©ì „ ì™„ë£Œ!'],
    'light': ['ê°€ë³ê²Œ ë¨¹ê¸° ë”±ì´ì—ìš”! âœ¨', 'ë¶€ë‹´ ì—†ì´ ì¦ê¸¸ ìˆ˜ ìˆì–´ìš”', 'ê°€ë²¼ìš´ í•œ ë¼ë¡œ ì¢‹ì•„ìš”'],
    'heavy': ['ë“ ë“ í•˜ê²Œ ë°° ì±„ìš°ê¸° ì¢‹ì•„ìš”! ğŸ–', 'í¬ë§Œê° ë§Œì¡±!', 'ë°°ë¶€ë¥´ê²Œ ë¨¹ì„ ìˆ˜ ìˆì–´ìš”']
  };
  
  if(goal && reasons[goal]) {
    return reasons[goal][Math.floor(Math.random() * reasons[goal].length)];
  }
  return 'ëƒ‰ì¥ê³  ì¬ë£Œë¡œ ì§€ê¸ˆ ë§Œë“¤ê¸° ì¢‹ì€ ìš”ë¦¬ì˜ˆìš”! ğŸ‘';
}

function copyRecipe(r){
  const text = `ğŸ³ ${r.name}
ì¶”ì²œ ì´ìœ : ${getReason(r)}
ì¡°ë¦¬ì‹œê°„: ${r.time}ë¶„
${r.steps ? `ì¡°ë¦¬ ë°©ë²•:\n${r.steps.map((s, i) => `${i+1}. ${s}`).join('\n')}` : ''}
#ëƒ‰ì¥ê³ êµ¬ì¡°ëŒ€ #fridge`; 
  navigator.clipboard.writeText(text);
  const messages = ['ë³µì‚¬ ì™„ë£Œ! ğŸ“‹', 'ë ˆì‹œí”¼ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”! âœ¨', 'ì €ì¥í–ˆì–´ìš”! ğŸ‘'];
  alert(messages[Math.floor(Math.random() * messages.length)]);
}

function toggleFavorite(name){
  if(favorites.includes(name)){
    favorites = favorites.filter(f=>f!==name);
  } else {
    favorites.push(name);
  }
  localStorage.setItem('fridge.favorites', JSON.stringify(favorites));
  recommend();
}

function renderHistory(){
  const wrap = document.getElementById('history');
  wrap.innerHTML='';
  history.slice(-7).reverse().forEach(h=>{
    const d=document.createElement('div');
    d.className='card';
    d.innerHTML=`<strong>${h.name}</strong><br/><small>${h.date}</small>`;
    wrap.appendChild(d);
  });
}

function recommend(){
  if(selectedIngredients.length === 0) {
    document.getElementById('result').innerHTML = '<p style="color:#dc2626; padding:20px; background:#fee2e2; border-radius:8px;">ğŸ˜… ì•„ì§ ì¬ë£Œë¥¼ ì„ íƒí•˜ì§€ ì•Šìœ¼ì…¨ì–´ìš”!<br/>STEP 1ë¡œ ëŒì•„ê°€ì„œ ëƒ‰ì¥ê³ ì— ìˆëŠ” ì¬ë£Œë¥¼ ì²´í¬í•´ì£¼ì„¸ìš”.</p>';
    return;
  }
  
  const perishables = ['ë‘ë¶€','ì½©ë‚˜ë¬¼','ì–‘ë°°ì¶”','ë²„ì„¯','ì‹œê¸ˆì¹˜','ìƒì¶”'];
  const ranked = recipes
    .map(r => {
      let s = scoreRecipe(r);
      if(s < 0) return null;
      if(r.required.some(x=>perishables.includes(x))) s += 4;
      if(favorites.includes(r.name)) s += 5;
      // ì„ íƒ ì¬ë£Œê°€ ë§ì„ìˆ˜ë¡ ì ìˆ˜ ì¶”ê°€
      if(r.optional) {
        const matchedOptional = r.optional.filter(opt => selectedIngredients.includes(opt)).length;
        s += matchedOptional * 2;
      }
      return {...r, score:s};
    })
    .filter(r => r !== null && r.score > 0)
    .sort((a,b)=>b.score-a.score)
    .slice(0,5); // 5ê°œê¹Œì§€ í‘œì‹œ

  const res = document.getElementById('result');
  res.innerHTML = '';
  
  if(!ranked.length) {
    const messages = [
      'ğŸ˜¢ ì•„ì‰½ê²Œë„ ì„ íƒí•˜ì‹  ì¬ë£Œë¡œëŠ” ë§Œë“¤ ìˆ˜ ìˆëŠ” ìš”ë¦¬ê°€ ì—†ì–´ìš”...<br/>ì¬ë£Œë¥¼ ë” ì¶”ê°€í•´ë³´ì‹œê±°ë‚˜ STEP 1ë¡œ ëŒì•„ê°€ì„œ ë‹¤ì‹œ ì„ íƒí•´ë³¼ê¹Œìš”?',
      'ğŸ¤” ì„ íƒí•˜ì‹  ì¬ë£Œë§Œìœ¼ë¡œëŠ” ìš”ë¦¬ë¥¼ ë§Œë“¤ê¸° ì–´ë ¤ì›Œìš”...<br/>ëƒ‰ì¥ê³ ì— ë‹¤ë¥¸ ì¬ë£Œë„ ìˆë‚˜ìš”? ë‹¤ì‹œ ì²´í¬í•´ë³¼ê¹Œìš”?',
      'ğŸ’” êµ¬ì¡° ì‹¤íŒ¨... í•˜ì§€ë§Œ í¬ê¸°í•˜ì§€ ë§ˆì„¸ìš”!<br/>ì¬ë£Œë¥¼ ì¡°ê¸ˆ ë” ì¶”ê°€í•˜ë©´ ë§›ìˆëŠ” ìš”ë¦¬ë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ ê±°ì˜ˆìš”!'
    ];
    res.innerHTML = `<p style="color:#dc2626; padding:20px; background:#fee2e2; border-radius:8px;">${messages[Math.floor(Math.random() * messages.length)]}</p>`;
    renderHistory();
    return;
  }

  // ì„±ê³µ ë©”ì‹œì§€
  const successMessages = [
    `ì¢‹ì€ ì†Œì‹ì´ì—ìš”! ${ranked.length}ê°œì˜ ìš”ë¦¬ë¥¼ ì°¾ì•˜ì–´ìš”! ğŸ‰`,
    `ëƒ‰ì¥ê³  êµ¬ì¡° ì„±ê³µ! ${ranked.length}ê°€ì§€ ìš”ë¦¬ë¥¼ ì¶”ì²œí•´ë“œë¦´ê²Œìš”! âœ¨`,
    `ì™€! ${ranked.length}ê°œì˜ ë§›ìˆëŠ” ìš”ë¦¬ë¥¼ ë°œê²¬í–ˆì–´ìš”! ğŸ³`
  ];
  res.innerHTML = `<p style="color:#059669; padding:12px; background:#d1fae5; border-radius:8px; margin-bottom:16px; font-weight:500;">${successMessages[Math.floor(Math.random() * successMessages.length)]}</p>`;
  
  ranked.forEach((r, idx) => {
    // íˆìŠ¤í† ë¦¬ì— ì¤‘ë³µ ì¶”ê°€ ë°©ì§€
    const exists = history.some(h => h.name === r.name && h.date === new Date().toLocaleDateString());
    if(!exists) {
      history.push({name:r.name, date:new Date().toLocaleDateString()});
    }
    localStorage.setItem('fridge.history', JSON.stringify(history));

    const div = document.createElement('div');
    div.className = 'card';
    div.style.borderLeft = idx === 0 ? '4px solid #059669' : '1px solid #e5e7eb';
    div.style.background = idx === 0 ? '#f0fdf4' : '#fff';
    
    // ì„ íƒ ì¬ë£Œ í‘œì‹œ
    const hasOptional = r.optional && r.optional.some(opt => selectedIngredients.includes(opt));
    const optionalText = r.optional && hasOptional 
      ? `<br/><small style="color:#059669;">âœ¨ ë³´ë„ˆìŠ¤ ì¬ë£Œ: ${r.optional.filter(opt => selectedIngredients.includes(opt)).join(', ')}</small>`
      : '';
    
    // ì¡°ë¦¬ ë‹¨ê³„ í‘œì‹œ
    const stepsText = r.steps ? `<br/><details style="margin-top:8px;"><summary style="cursor:pointer; color:#666; font-weight:500;">ğŸ“ ì¡°ë¦¬ ë°©ë²• ë³´ê¸° (${r.steps.length}ë‹¨ê³„)</summary><ol style="margin:8px 0; padding-left:20px; color:#666; font-size:13px; line-height:1.8;">${r.steps.map(s => `<li>${s}</li>`).join('')}</ol></details>` : '';
    
    const rankEmoji = idx === 0 ? 'ğŸ¥‡' : idx === 1 ? 'ğŸ¥ˆ' : idx === 2 ? 'ğŸ¥‰' : 'ğŸ‘';
    
    div.innerHTML = `
      <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
        <span style="font-size:20px;">${rankEmoji}</span>
        <strong style="font-size:18px;">${r.name}</strong> ${favorites.includes(r.name)?'â¤ï¸':''}
      </div>
      â± ${r.time}ë¶„ Â· ì¶”ì²œë„ ${r.score}ì <br/>
      <small style="color:#666;">${getReason(r)}</small>${optionalText}${stepsText}<br/>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button onclick="copyRecipe(${JSON.stringify(r).replace(/"/g, '&quot;')})" style="flex:1; min-width:100px;">ğŸ“‹ ë³µì‚¬í•˜ê¸°</button>
        <button onclick="toggleFavorite('${r.name.replace(/'/g, "\\'")}')" class="secondary" style="flex:1; min-width:100px;">${favorites.includes(r.name)?'â¤ï¸ ì¦ê²¨ì°¾ê¸° í•´ì œ':'ğŸ¤ ì¦ê²¨ì°¾ê¸°'}</button>
      </div>
    `;
    res.appendChild(div);
  });
  
  renderHistory();
}

// ì´ˆê¸°í™”
renderIngredients();
updateNextButton(1);
if(goal) updateGoalButtons();
if(taste) updateTasteButtons();
</script>

</body>
</html>
